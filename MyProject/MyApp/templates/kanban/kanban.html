{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban Board</title>
    <!-- <link rel="stylesheet" href="{% static 'css/kanban.css' %}"> -->
    <script src="{% static 'kanban.js' %}" defer></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
    <style>
    .is-dragging {
    scale: 1.05;
    box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.25);
    background: rgb(50, 50, 50);
    color: white;
  }
    </style>
    
    <div class="board container mt-4 mb-5">
        <a href="{% url 'dashboard' %}" class="btn btn-secondary mb-3">Back to Dashboard</a>
        {% if user.role == 'project_leader' %}
        <div class="form-group mb-3">
            <label for="project-select" class="form-label me-2">Select Project:</label>
            <select id="project-select" class="form-select">
                <option value="">-- All Projects --</option>
                {% for project in projects %}
                    <option value="{{ project.id }}">{{ project.name }}</option>
                {% endfor %}
            </select>
        </div>
            <div class="d-flex justify-content-between align-items-center mb-3">
                <a href="{% url 'task_create' %}" class="btn btn text-white" style="background-color: #457B9D;">Add Task</a>
               
            </div>
        {% endif %}
        <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
    
        <div class="row gx-3 gy-4">
            <!-- Requested Lane (Pending tasks) -->
            <div class="col-lg-4">
                <div class="card shadow-lg rounded-4  h-100" >
                    <div class="card-header  text-white  text-center rounded-top-4 py-3" style="background-color: #E63946;">
                        <h5 class="card-title mb-0">Requested</h5>
                    </div>
                    <div class="card-body swim-lane" id="todo-lane"  style="max-height: 400px; overflow-y: auto;">
                        {% for task in tasks %}
                            {% if task.status == 'pending' %}
                                <div class="card mb-3 task" draggable="true" data-id="{{ task.id }}" data-project-id="{{ task.project.id }}">
                                    <div class="card-body">
                                        <p class="task-content fw-bold">{{ task.name }}</p>
                                        {% if user.role == 'project_leader' %}
                                            <p class="mb-1"><small>Assigned to: {{ task.assigned_to }}</small></p>
                                        {% endif %}
                                        <small class="text-muted">Due: {{ task.due_date }}</small>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
    
            <!-- In Progress Lane -->
            <div class="col-lg-4">
                <div class="card shadow-lg rounded-4  h-100">
                    <div class="card-header  text-white rounded-top-4 text-center py-3" style="background-color: #457B9D;" >
                        <h5 class="card-title mb-0">In Progress</h5>
                    </div>
                    <div class="card-body swim-lane" id="in-progress-lane"  style="max-height: 400px; overflow-y: auto;">
                        {% for task in tasks %}
                            {% if task.status == 'in_progress' %}
                                <div class="card mb-3 task" draggable="true" data-id="{{ task.id }}" data-project-id="{{ task.project.id }}">
                                    <div class="card-body">
                                        <p class="task-content fw-bold">{{ task.name }}</p>
                                        {% if user.role == 'project_leader' %}
                                            <p class="mb-1"><small>Assigned to: {{ task.assigned_to }}</small></p>
                                        {% endif %}
                                        {% if user.role == 'team_member' %}
                                            <p class="mb-1"><small>project name: {{ task.project }}</small></p>
                                        {% endif %}
                                        <small class="text-muted">Due: {{ task.due_date }}</small>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
    
            <!-- Completed Lane -->
            <div class="col-lg-4">
                <div class="card shadow-lg rounded-4 h-100">
                    <div class="card-header  text-white text-center rounded-top-4  py-3" style="background-color: #A8DADC;">
                        <h5 class="card-title mb-0">Completed</h5>
                    </div>
                    <div class="card-body swim-lane" id="done-lane"  style="max-height: 400px; overflow-y: auto;">
                        {% for task in tasks %}
                            {% if task.status == 'completed' %}
                                <div class="card mb-3 task" draggable="true" data-id="{{ task.id }}" data-project-id="{{ task.project.id }}">
                                    <div class="card-body">
                                        <p class="task-content fw-bold">{{ task.name }}</p>
                                        {% if user.role == 'project_leader' %}
                                            <p class="mb-1"><small>Assigned to: {{ task.assigned_to }}</small></p>
                                        {% endif %}
                                        {% if user.role == 'team_member' %}
                                            <p class="mb-1"><small>project name: {{ task.project }}</small></p>
                                        {% endif %}
                                        <small class="text-muted">Due: {{ task.due_date }}</small>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-container"></div>
  
</body>
</html>
