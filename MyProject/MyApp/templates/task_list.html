{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasks</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <style>
        /* Add border to profile picture */
        .profile-picture {
            border: 3px solid #457B9D; /* Sky Blue border */
            padding: 3px; /* Adds spacing inside the border */
        }
    </style>
</head>
<body class="bg-light">
    
    <!-- Sidebar Navigation -->
    <div class="sidebar" style="background-color: #1D3557; height: 100vh; position: fixed; width: 250px;">
        <h2 class="text-white text-center py-3">TaskFlow</h2>
        <ul class="list-unstyled">
            <li><a class="text-white p-3 d-block" href="{% url 'dashboard' %}">Dashboard</a></li>
            <li><a class="text-white p-3 d-block" href="{% url 'project_list' %}">Projects</a></li>
            <li><a class="text-white p-3 d-block" href="{% url 'task_list' %}">Tasks</a></li>
            <li><a class="text-white p-3 d-block" href="team-management">Team Management</a></li>
            <!-- Dynamic Reports link -->
                {% if user.role == 'project_leader' %}
                    <li><a class="text-white p-3 d-block" href="{% url 'leader-reports' %}">Reports</a></li>
                {% else %}
                    <li><a class="text-white p-3 d-block" href="{% url 'member-reports' %}">Reports</a></li>
                {% endif %}
            <li><a class="text-white p-3 d-block" href="settings">Settings</a></li>
        </ul>
    </div>

    <!-- Main Content Area -->
    <div class="main-content" style="margin-left: 250px; padding: 30px;">

        <!-- Top Navigation Bar -->
        <div class="top-nav d-flex justify-content-between align-items-center mb-4">
            <div></div> <!-- Empty div for spacing -->

            <!-- Profile Dropdown in Top Right -->
            <div class="dropdown">
                <button class="btn btn-link text-dark" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    {% if user.profile_picture %}
                        <img src="{{ user.profile_picture.url }}"
                             alt="Profile Picture"
                             class="img-fluid rounded-circle profile-picture"
                             style="width: 75px; height: 75px;">
                    {% else %}
                        <img src="{% static 'img/default_profile.png' %}"
                             alt="Default Profile"
                             class="img-fluid rounded-circle profile-picture"
                             style="width: 75px; height: 75px;">
                    {% endif %}
                </button>
                <ul class="dropdown-menu" aria-labelledby="profileDropdown">
                    <li><a class="dropdown-item" href="{% url 'profile' %}">Profile</a></li>
                    <li><a class="dropdown-item text-danger" href="{% url 'logout' %}">Logout</a></li>
                </ul>
            </div>
        </div>

        <h1>Your Tasks</h1>
        {% if user.role == 'project_leader' %} 
            <a href="{% url 'task_create' %}" class="btn btn-success mb-3">+ Create Task</a>
        {% endif %}

        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Task Name</th>
                    <th>Assigned To</th>
                    <th>Project</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Due Date</th>
                    <th>Update</th>
                    {% if user.role == 'project_leader' %} 
                        <th>Delete</th>
                    {% endif %}
                    
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                    <tr>
                        <td>{{ task.name }}</td>
                        <td>{{ task.assigned_to.username }}</td>
                        <td>{{ task.project.name }}</td>
                        <td>
                            {% if task.status == 'completed' %}
                                <span class="badge bg-success">Completed</span>
                            {% elif task.status == 'in_progress' %}
                                <span class="badge bg-warning text-dark">In Progress</span>
                            {% else %}
                                <span class="badge bg-danger">Pending</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if task.priority == 'urgent' %}
                                <span class="badge bg-danger">Urgent</span>
                            {% elif task.priority == 'important' %}
                                <span class="badge bg-warning text-dark">Important</span>
                            {% else %}
                                <span class="badge bg-secondary">Can Wait</span>
                            {% endif %}
                        </td>
                        <td>{{ task.due_date }}</td>
                        <td>
                            <a href="{% url 'task_update' task.id %}" class="btn btn-primary btn-sm">Edit</a>
                        </td>
                        {% if user.role == 'project_leader' %} 
                            <td>
                                <a href="{% url 'task_delete' task.id %}" class="btn btn-danger btn-sm">Delete</a>
                            </td>
                        {% endif %}
                        
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="7" class="text-center text-muted">No tasks found.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
